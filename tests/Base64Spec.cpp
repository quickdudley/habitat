#include "Base64.h"
#include <catch2/catch_all.hpp>
#include <cstring>
#include <vector>

TEST_CASE("Decodes sample signature correctly", "[base64]") {
  const char sample[] =
      "8XdA3TwXsWasY8PGo5zI/QJAi6XsyCklzQv8dVtgOEZk4jRCVFDLb4OCK7H/"
      "s+lxOcxjpKn4NGocbQ7Z5mF5CQ==.sig.ed25519";
  auto decoded = base64::decode(sample, strlen(sample));
  REQUIRE(decoded.size() == 64);
  std::vector<unsigned char> reference = {
      0xf1, 0x77, 0x40, 0xdd, 0x3c, 0x17, 0xb1, 0x66, 0xac, 0x63, 0xc3,
      0xc6, 0xa3, 0x9c, 0xc8, 0xfd, 0x02, 0x40, 0x8b, 0xa5, 0xec, 0xc8,
      0x29, 0x25, 0xcd, 0x0b, 0xfc, 0x75, 0x5b, 0x60, 0x38, 0x46, 0x64,
      0xe2, 0x34, 0x42, 0x54, 0x50, 0xcb, 0x6f, 0x83, 0x82, 0x2b, 0xb1,
      0xff, 0xb3, 0xe9, 0x71, 0x39, 0xcc, 0x63, 0xa4, 0xa9, 0xf8, 0x34,
      0x6a, 0x1c, 0x6d, 0x0e, 0xd9, 0xe6, 0x61, 0x79, 0x09};
  REQUIRE(decoded == reference);
}
